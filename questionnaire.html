<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindInsight - Questionnaire</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-green: #4CAF50;
      --light-green: #8BC34A;
      --dark-green: #2E7D32;
      --accent-green: #A5D6A7;
      --bg-green: #E8F5E9;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #FFFFFF;
      color: #333;
    }
    
    .btn-primary {
      background-color: var(--primary-green);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: var(--dark-green);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .question-card {
      border-left: 4px solid var(--primary-green);
      transition: all 0.3s ease;
    }
    
    .question-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
    }
    
    textarea:focus {
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px var(--accent-green);
    }

    .shape {
      position: absolute;
      z-index: -1;
      opacity: 0.4;
    }

    .word-counter {
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }

    .word-counter.warning {
      color: #f59e0b;
    }

    .word-counter.success {
      color: var(--primary-green);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .modal-content {
      background-color: white;
      border-radius: 1rem;
      max-width: 500px;
      width: 90%;
      animation: modalFadeIn 0.5s ease;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .hero-gradient {
      background: linear-gradient(135deg, var(--bg-green) 0%, #FFFFFF 100%);
    }

    .funky-circle {
      position: absolute;
      border-radius: 50%;
      background-color: var(--accent-green);
      opacity: 0.2;
      z-index: -1;
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
      100% { transform: translateY(0px) rotate(0deg); }
    }

    .error-message {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="bg-white shadow-md py-4 fixed w-full z-10">
    <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
      <div class="flex items-center">
        <i class="fas fa-brain text-3xl text-green-600 mr-2"></i>
        <h1 class="text-2xl font-bold text-gray-800">Mind<span class="text-green-600">Insight</span></h1>
      </div>
      <div class="hidden md:flex space-x-6">
        <a href="/" class="text-gray-700 hover:text-green-600 transition duration-300">Home</a>
      </div>
      <div class="md:hidden">
        <button class="text-gray-700 focus:outline-none">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- Add this right after the closing </nav> tag -->
  <!-- Decorative shapes -->
  <div class="shape" style="top: 20%; left: 5%; width: 150px; height: 150px;">
    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <path fill="#4CAF50" d="M43.5,-62.3C55.2,-52.8,62.8,-38.2,68.4,-22.9C73.9,-7.6,77.5,8.3,73.8,22.5C70.1,36.7,59.2,49.1,45.5,57.6C31.8,66.1,15.9,70.6,0.1,70.5C-15.8,70.4,-31.5,65.5,-43.8,56.2C-56.1,46.9,-64.9,33.1,-69.2,17.6C-73.5,2,-73.3,-15.3,-67.1,-29.5C-60.9,-43.7,-48.7,-54.9,-35.5,-63.5C-22.3,-72.1,-7.7,-78.1,5.6,-85.5C16.9,-90.9,29.6,-70.8,29.6,-70.8L43.5,-62.3Z" transform="translate(100 100)" />
    </svg>
  </div>

  <div class="shape" style="top: 50%; right: 5%; width: 200px; height: 200px;">
    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <path fill="#8BC34A" d="M45.5,-44.2C57.2,-27.6,63.8,-9.7,63.4,11.1C62.9,31.9,55.5,55.8,39.5,65.8C23.6,75.7,-1,71.8,-22.9,62.9C-44.8,54,-64.1,40.2,-71.6,21.8C-79.1,3.4,-74.9,-19.5,-62.3,-37.2C-49.7,-54.9,-28.8,-67.4,-7.6,-61.2C13.5,-55,33.8,-60.7,45.5,-44.2Z" transform="translate(100 100)" />
    </svg>
  </div>

  <div class="shape" style="bottom: 10%; left: 15%; width: 120px; height: 120px;">
    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
      <path fill="#A5D6A7" d="M54.9,-63.2C66.2,-52.1,67.8,-30.8,70.1,-9.9C72.4,11,75.3,31.5,66.5,44.5C57.7,57.5,37.1,63,17.4,68.4C-2.4,73.9,-21.2,79.1,-38.1,73.5C-55,67.9,-69.9,51.3,-73.9,33.2C-77.9,15.1,-71,-4.7,-64.1,-23.9C-57.2,-43.1,-50.3,-61.9,-37.7,-72.4C-25.1,-82.9,-6.9,-85.1,8.7,-94.8C24.2,-104.5,43.5,-74.2,43.5,-74.2L54.9,-63.2Z" transform="translate(100 100)" />
    </svg>
  </div>

  <!-- Questionnaire Section -->
  <section class="pt-28 pb-20 hero-gradient relative overflow-hidden">
    <div class="funky-circle" style="width: 300px; height: 300px; top: 10%; left: 5%;"></div>
    <div class="funky-circle" style="width: 200px; height: 200px; bottom: 15%; right: 10%;"></div>

    <div class="container mx-auto px-4 md:px-6">
      <!-- ... keep existing content THE SAME below this line ... -->
      <div class="max-w-3xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Depression Self-Assessment</h1>
        <p class="text-gray-600 mb-8">Please answer the following questions honestly to get the most accurate assessment. Your responses are completely private and not stored after analysis.</p>
        
        <!-- Add this after the <h1> and <p> tags at the top of the questionnaire section -->
        <div class="bg-white p-4 rounded-lg shadow-md mb-8">
          <div class="flex items-start">
            <div class="bg-green-100 p-2 rounded-full mr-4">
              <i class="fas fa-info-circle text-green-600"></i>
            </div>
            <div>
              <h3 class="font-semibold mb-1">Important Note</h3>
              <p class="text-sm text-gray-600">Your responses are completely private and not stored after analysis. Each question requires a minimum of 30 words for the best assessment.</p>
            </div>
          </div>
        </div>
        
        <form id="questionnaireForm" action="/classify-questionnaire" method="POST" class="space-y-6">
          <!-- Question 1 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">1. How would you describe your mood most days?</h3>
            <!-- Replace each existing textarea with this pattern -->
            <textarea name="text1" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>         
          </div>
          
          <!-- Question 2 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">2. How is your energy level throughout the day?</h3>
            <!-- Replace each existing textarea with this pattern -->
            <textarea name="text2" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 3 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">3. How has your interest in activities changed recently?</h3>
            <!-- Replace each existing textarea with this pattern -->
            <textarea name="text3" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 4 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">4. Describe your sleep patterns lately.</h3>
            <textarea name="text4" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 5 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">5. How would you describe your appetite and any changes?</h3>
            <textarea name="text5" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 6 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">6. How do you feel about yourself most days?</h3>
            <textarea name="text6" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 7 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">7. How is your concentration when working or doing tasks?</h3>
            <textarea name="text7" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 8 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">8. Do you notice changes in how quickly or slowly you move or speak?</h3>
            <textarea name="text8" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 9 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">9. Have you had thoughts of not wanting to be alive or hurting yourself?</h3>
            <textarea name="text9" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 10 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">10. How do you feel about the future?</h3>
            <textarea name="text10" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 11 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">11. How would you describe your social interactions lately?</h3>
            <textarea name="text11" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
            <div class="flex justify-between mt-2">
              <div class="word-counter text-gray-500">0/30 words minimum</div>
              <div class="text-xs text-gray-400"><i class="fas fa-lock mr-1"></i> Private</div>
            </div>
          </div>
          
          <!-- Question 12 -->
          <div class="question-card bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">12. Is there anything else you'd like to share about how you're feeling?</h3>
            <textarea name="text12" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none" placeholder="Share your thoughts here..."></textarea>
          </div>
          
          <div class="text-center">
            <button type="submit" class="btn-primary px-8 py-3 rounded-full text-white font-semibold text-lg">
              Get Your Assessment
              <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </form>
        
        <div class="mt-8 text-center text-gray-600 text-sm">
          <p>This assessment is not a diagnostic tool. If you're experiencing severe symptoms, please contact a mental health professional.</p>
          <p class="mt-2">National Suicide Prevention Lifeline: 988 or 1-800-273-8255</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-4 md:px-6 text-center">
      <div class="flex items-center justify-center mb-4">
        <i class="fas fa-brain text-2xl text-green-400 mr-2"></i>
        <h2 class="text-xl font-bold">Mind<span class="text-green-400">Insight</span></h2>
      </div>
      <p class="text-gray-400">&copy; 2025 MindInsight. All rights reserved.</p>
      <p class="mt-2 text-gray-400">This tool is not a substitute for professional medical advice, diagnosis, or treatment.</p>
    </div>
  </footer>

  <!-- Add this right before the closing </body> tag -->
  <!-- Disclaimer Modal -->
  <div id="disclaimerModal" class="modal">
    <div class="modal-content p-6 max-w-md mx-auto">
      <div class="text-center mb-4">
        <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl"></i>
      </div>
      <h2 class="text-2xl font-bold text-center mb-4">Important Disclaimer</h2>
      <p class="mb-4">This self-assessment tool is <strong>not a substitute for professional medical help</strong>. It is designed to provide insights only and should not be used for diagnosis or treatment decisions.</p>
      <p class="text-sm text-gray-600 mb-6">If you're experiencing severe symptoms or thoughts of self-harm, please contact a mental health professional or emergency services immediately.</p>
      <div class="text-center">
        <button id="acceptDisclaimer" class="btn-primary px-8 py-3 rounded-full text-white font-semibold pulse">
          I Understand
        </button>
      </div>
    </div>
  </div>

  <script>
    // Mobile menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const menuButton = document.querySelector('nav button');
      const mobileMenu = document.createElement('div');
      mobileMenu.className = 'fixed top-0 left-0 w-full h-full bg-white z-50 transform translate-x-full transition duration-300 ease-in-out';
      mobileMenu.innerHTML = `
        <div class="flex justify-end p-6">
          <button class="text-gray-700 focus:outline-none">
            <i class="fas fa-times text-2xl"></i>
          </button>
        </div>
        <div class="flex flex-col items-center space-y-6 mt-10">
          <a href="/" class="text-xl text-gray-700 hover:text-green-600 transition duration-300">Home</a>
        </div>
      `;
      
      document.body.appendChild(mobileMenu);
      
      menuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('translate-x-full');
        mobileMenu.classList.toggle('translate-x-0');
        document.body.classList.toggle('overflow-hidden');
      });
    });

    // Form submission handling
    const form = document.getElementById('questionnaireForm');
    const textareas = document.querySelectorAll('textarea');
    const minWords = 30;

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      document.querySelectorAll('.error-message').forEach(el => el.remove());

      // Validate input
      let hasValidInput = false;
      const wordCounts = [];
      textareas.forEach(textarea => {
        const count = textarea.value.trim().split(/\s+/).filter(Boolean).length;
        wordCounts.push(count);
        if (count >= minWords) hasValidInput = true;
      });

      if (!hasValidInput) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.innerHTML = `
          <i class="fas fa-exclamation-circle mr-2"></i>
          Please provide at least one answer with 30+ words
        `;
        form.parentNode.insertBefore(errorDiv, form.nextSibling);
        errorDiv.scrollIntoView({ behavior: 'smooth' });
        return;
      }

      try {
        const formData = new FormData(form);
        const response = await fetch('/classify-questionnaire', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error('Server Error:', response.status, errorText);
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();

        if (!data || 
            typeof data.final_class === 'undefined' ||
            !Array.isArray(data.individual_results) || 
            data.individual_results.length !== 12 ||
            data.individual_results.some(item => !('predicted_class' in item && 'confidence' in item))) {
          console.error('Invalid response structure:', data);
          throw new Error('Invalid analysis results from server');
      }

        sessionStorage.setItem('assessmentResults', JSON.stringify(data));
        window.location.href = '/results';

      } catch (error) {
        console.error('Full error details:', error);
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.innerHTML = `
          <i class="fas fa-exclamation-circle mr-2"></i>
          ${error.message.replace(/^Error:\s*/i, '')}. Please try again.
        `;
        form.parentNode.insertBefore(errorDiv, form.nextSibling);
        errorDiv.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Fixed word counter functionality
    textareas.forEach(textarea => {
      textarea.addEventListener('input', function() {
        const wordCount = this.value.trim().split(/\s+/).filter(Boolean).length;
        const counter = this.closest('.question-card').querySelector('.word-counter');
        
        counter.textContent = `${wordCount}/${minWords} words minimum`;
        counter.classList.toggle('warning', wordCount < minWords);
        counter.classList.toggle('success', wordCount >= minWords);
        
      });
    });


    // Disclaimer modal handling
    const modal = document.getElementById('disclaimerModal');
    const acceptButton = document.getElementById('acceptDisclaimer');
    window.addEventListener('DOMContentLoaded', () => {
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    });
    acceptButton.addEventListener('click', () => {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });
</script>
  
</body>
</html>